# cap-store-db

## イメージ作成方法

1. Dockerfile作成

```dockerFile
FROM postgres:latest

# 初期化スクリプトをコピー
COPY *.csv /tmp/init_data/
COPY init.sql /docker-entrypoint-initdb.d/
```

2. DDL・テーブルデータをエクスポート

- categories.csv
- makers.csv
- init.sql

```sql
CREATE TABLE public.categories (
 id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE),
 "name" text NOT NULL,
 image_url text NULL,
 CONSTRAINT "PK_categories" PRIMARY KEY (id)
);
CREATE INDEX "IX_categories_name" ON public.categories USING btree (name);

COPY public.categories FROM '/tmp/init_data/categories.csv' DELIMITER ',' CSV HEADER;

CREATE TABLE public.makers (
 id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE),
 "name" text NOT NULL,
 image_url text NULL,
 CONSTRAINT "PK_makers" PRIMARY KEY (id)
);
CREATE INDEX "IX_makers_name" ON public.makers USING btree (name);

COPY public.makers FROM '/tmp/init_data/makers.csv' DELIMITER ',' CSV HEADER;
```

3. Dockerfileビルド

```bash
docker build -t cap-store-db:0.0.2 .
```

## 参考文献

DockerでPostgreSQLを立ててCSV取り込みするまで
<https://qiita.com/yo16/items/742f9b883cd978b9b75e>
